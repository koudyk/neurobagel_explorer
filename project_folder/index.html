<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>NeuroBagel Explorer</title>
    <link rel="stylesheet" href="style.css">
    <script>
        /*to prevent Firefox FOUC, this must be here*/
        let FF_FOUC_FIX;
    </script>
</head>

<body>

    <div>
        <h1 id="title">
            <img src="2023-11-06_nb_ko_neurobagel-logo_no-words.png" class="logo">
            <span>NeuroBagel Explorer</span>
        </h1>
        <h3 id="subtitle">See what data is available at the subject level</h3>
    </div>
    <div class="container">
        <div class="container" id="barchart">
            <script type="module">
                import * as d3 from 'https://cdn.skypack.dev/d3@7';
                import * as _ from 'https://cdn.skypack.dev/underscore@1';
    
                // CODE ADAPTED FROM https://gist.github.com/d3noob/08cc6159b9315e20e74a72e85a50dd3e

                const file = "./data/modality.csv";
                const dataset = await d3.csv(file, d3.autoType);

                // Count rows per modality
                const groups = d3.groups(dataset, (d) => d.Modality);
                console.log(groups)
                globalThis.groups = groups;

                let unselectedData = new Array();
                for (let i = 0; i < groups.length; i++) {
                    let modality = groups[i][0];
                    let count = groups[i][1].length;
                    unselectedData.push({ modality: modality, count: count });
                }

                // set the dimensions and margins of the graph
                const margin = { top: 20, right: 20, bottom: 80, left: 100 },
                    width = 500 - margin.left - margin.right,
                    height = 400 - margin.top - margin.bottom;

                // set the ranges
                const x = d3.scaleBand()
                    .range([0, width])
                    .padding(0.1);
                const y = d3.scaleLinear()
                    .range([height, 0]);

                // Scale the range of the data in the domains
                x.domain(unselectedData.map(function (d) { return d.modality; }));
                y.domain([0, d3.max(unselectedData, function (d) { return d.count; })]);

                // append the svg object to the body of the page
                // append a 'group' element to 'svg'
                // moves the 'group' element to the top left margin
                var svg = d3.select("body").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                function drill(d, i) {

                };

                // create bars
                svg.selectAll(".bar")
                    .data(unselectedData)
                    .join("rect")
                    .attr("class", "lightGreyBar")
                    .attr("x", d => x(d.modality))
                    .attr("width", x.bandwidth())
                    .attr("y", d => y(d.count))
                    .attr("height", d => height - y(d.count))

                // add the x Axis
                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x))
                        .attr("class", "axis")
                        .selectAll("text")  
                        .style("text-anchor", "end")
                        .attr("dx", ".8em")
                        .attr("dy", ".70em")
                        .attr("transform", "rotate(-20)")
                        .attr("font-size", "15");
                        
                        
                // text label for the x axis
                svg.append("text")             
                    .attr("transform",
                            "translate(" + (width/2) + " ," + 
                                        (height + margin.top + 55) + ")")
                    .style("text-anchor", "middle")
                    .text("Imaging Modality");

                // add the y Axis
                svg.append("g")
                    .call(d3.axisLeft(y))
                        .attr("font-size", "15")
                        .attr("class", "axis");

                // text label for the y axis
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left)
                    .attr("x",0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text("Number of Participants");  

            </script>
        </div>


        <div class="container" id="histogram">
            <script type="module">
                import * as d3 from 'https://cdn.skypack.dev/d3@7';
                import * as _ from 'https://cdn.skypack.dev/underscore@1';

                // CODE ADAPTED FROM https://gist.github.com/d3noob/08cc6159b9315e20e74a72e85a50dd3e

                const file = "./data/demographics.csv";

                const dataset = await d3.csv(file, d3.autoType);

                // Count rows per age
                const groups = d3.groups(dataset, (d) => d.Age);

                let unselectedData = new Array();
                let justAges = new Array();
                for (let i = 0; i < groups.length; i++) {
                    let age = groups[i][0];
                    let count = groups[i][1].length;
                    unselectedData.push({ age: age, count: count });
                }

                unselectedData.forEach(function(d) {
                    d.age = +d.age;
                    d.count = +d.count;
                })

                globalThis.unselectedData = unselectedData

                // set the dimensions and margins of the graph
                const margin = { top: 20, right: 20, bottom: 80, left: 100 },
                    width = 700 - margin.left - margin.right,
                    height = 400 - margin.top - margin.bottom;

                // set the ranges
                const x = d3.scaleLinear()
                    .range([0, width])
                   
                const y = d3.scaleLinear()
                    .range([height, 0]);


                // Scale the range of the data in the domains
                x.domain([0, d3.max(unselectedData, function (d) { return d.age; })]);
                y.domain([0, d3.max(unselectedData, function (d) { return d.count; })]);

                // append the svg object to the body of the page
                // append a 'group' element to 'svg'
                // moves the 'group' element to the top left margin
                var svg = d3.select("body").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`)
            

                var valueLine = d3.line()
                    .x(function(d) { return x(d.age)})
                    .y(function(d) {return y(d.count)});

                // add the valueLine path
                svg.append("path")
                    .data([unselectedData])
                    .attr("class", "line")
                    .attr("d", valueLine);

                // add the x Axis
                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x))
                        .attr("font-size", "15")
                        .attr('class', "axis")
                
                  // text label for the x axis
                svg.append("text")             
                    .attr("transform",
                            "translate(" + (width/2) + " ," + 
                                        (height + margin.top + 20) + ")")
                    .style("text-anchor", "middle")
                    .text("Age (Years)");

                // add the y Axis
                svg.append("g")
                    .call(d3.axisLeft(y))
                        .attr("font-size", "15")
                        .attr("class", "axis");

                  // text label for the y axis
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left)
                    .attr("x",0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text("Number of participants");  
                            </script>
        </div>
    </div>
</body>

</html>