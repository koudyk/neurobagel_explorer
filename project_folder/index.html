<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>NeuroBagel Explorer</title>
    <link rel="stylesheet" href="style.css">
    <script>
        /*to prevent Firefox FOUC, this must be here*/
        let FF_FOUC_FIX;
    </script>
</head>

<body>

    <div>
        <h1 id="title">
            <img src="2023-11-06_nb_ko_neurobagel-logo_no-words.png" class="logo">
            <span>NeuroBagel Explorer</span>
        </h1>
        <h3 id="subtitle">See what data is available at the subject level</h3>
    </div>
    <div class="container">
        <div class="container" id="barchart">
            <script type="module">
                import * as d3 from 'https://cdn.skypack.dev/d3@7';
                import * as _ from 'https://cdn.skypack.dev/underscore@1';
    
                // CODE ADAPTED FROM https://gist.github.com/d3noob/08cc6159b9315e20e74a72e85a50dd3e

                const file = "./data/modality.csv";
                const dataset = await d3.csv(file, d3.autoType);

                // Count rows per modality
                const groups = d3.groups(dataset, (d) => d.Modality);
                console.log(groups)
                globalThis.groups = groups;

                let unselectedData = new Array();
                for (let i = 0; i < groups.length; i++) {
                    let modality = groups[i][0];
                    let count = groups[i][1].length;
                    unselectedData.push({ modality: modality, count: count });
                }

                // set the dimensions and margins of the graph
                const margin = { top: 20, right: 20, bottom: 60, left: 40 },
                    width = 500 - margin.left - margin.right,
                    height = 400 - margin.top - margin.bottom;

                // set the ranges
                const x = d3.scaleBand()
                    .range([0, width])
                    .padding(0.1);
                const y = d3.scaleLinear()
                    .range([height, 0]);

                // Scale the range of the data in the domains
                x.domain(unselectedData.map(function (d) { return d.modality; }));
                y.domain([0, d3.max(unselectedData, function (d) { return d.count; })]);

                // append the svg object to the body of the page
                // append a 'group' element to 'svg'
                // moves the 'group' element to the top left margin
                var svg = d3.select("body").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                // create bars
                svg.selectAll(".bar")
                    .data(unselectedData)
                    .join("rect")
                    .attr("class", "lightGreyBar")
                    .attr("x", d => x(d.modality))
                    .attr("width", x.bandwidth())
                    .attr("y", d => y(d.count))
                    .attr("height", d => height - y(d.count));

                // add the x Axis
                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x))
                        .selectAll("text")  
                        .style("text-anchor", "end")
                        .attr("dx", "-.8em")
                        .attr("dy", ".15em")
                        .attr("transform", "rotate(-30)");

                // add the y Axis
                svg.append("g")
                    .call(d3.axisLeft(y));
            </script>
        </div>


        <div class="container" id="histogram">
            <script type="module">
                import * as d3 from 'https://cdn.skypack.dev/d3@7';
                import * as _ from 'https://cdn.skypack.dev/underscore@1';

                // CODE ADAPTED FROM https://gist.github.com/d3noob/08cc6159b9315e20e74a72e85a50dd3e

                const file = "./data/demographics.csv";

                const dataset = await d3.csv(file, d3.autoType);

                // Count rows per age
                const groups = d3.groups(dataset, (d) => d.Age);

                let unselectedData = new Array();
                let justAges = new Array();
                for (let i = 0; i < groups.length; i++) {
                    let age = groups[i][0];
                    let count = groups[i][1].length;
                    unselectedData.push({ age: age, count: count });
                }

                // sort the data
                unselectedData = unselectedData.sort(function(a, b) {
                    return d3.ascending(a.key)
                });

                // set the dimensions and margins of the graph
                const margin = { top: 20, right: 20, bottom: 30, left: 40 },
                    width = 700 - margin.left - margin.right,
                    height = 400 - margin.top - margin.bottom;

                // set the ranges
                const x = d3.scaleBand()
                    .range([0, width])
                   
                const y = d3.scaleLinear()
                    .range([height, 0]);


                // Scale the range of the data in the domains
                x.domain(unselectedData.map(function (d) { return d.age; }));
                y.domain([0, d3.max(unselectedData, function (d) { return d.count; })]);

                // append the svg object to the body of the page
                // append a 'group' element to 'svg'
                // moves the 'group' element to the top left margin
                var svg = d3.select("body").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                // create bars
                svg.selectAll(".bar")
                    .data(unselectedData)
                    .join("rect")
                    .attr("class", "lightGreyBar")
                    .attr("x", d => x(d.age))
                    .attr("width", x.bandwidth())
                    .attr("y", d => y(d.count))
                    .attr("height", d => height - y(d.count))

                // add the x Axis
                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x))
                        .selectAll("text")

                // add the y Axis
                svg.append("g")
                    .call(d3.axisLeft(y));
            </script>
        </div>
    </div>
</body>

</html>